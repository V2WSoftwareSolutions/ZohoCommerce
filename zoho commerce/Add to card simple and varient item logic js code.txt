<script>
  // Variant / UOM logic
  let infoJson = {
    dropDownCustomFieldId: "6866972000000509038",   // Case Quantity dropdown
    conversionCustomFieldId: "6866972000000509048", // Conversion hidden field
    hasVariantsFieldId: "6866972000000725541",      // Has Variants field ID
    showUnitNearPrice: true
  };

  console.log("UOM Script Initialized", infoJson);

  function waitForElement(selector, container, timeout = 5000) {
    return new Promise((resolve, reject) => {
      const startTime = Date.now();
      (function checkElement() {
        const element = container.querySelector(selector);
        if (element) {
          console.log("Element found:", selector);
          return resolve(element);
        }
        if (Date.now() - startTime > timeout) {
          console.error("Timeout waiting for element:", selector);
          return reject(new Error(`Element not found: ${selector}`));
        }
        setTimeout(checkElement, 100);
      })();
    });
  }

  /**
   * For Has variants = false:
   * - Auto-select a valid Case Quantity option
   * - Persist it as data-default-value (so Zoho keeps it after add-to-cart reset)
   * - Hide the whole "Pick a Case Size" accordion + Case Quantity row
   */
  function hideCaseSizeBlock(details) {
    console.log("üö´ Hiding Case Size / Case Quantity for simple product‚Ä¶");

    // --- 1) Find the Case Quantity select ---
    let selectElement =
      details.querySelector(
        `select[data-custom-field-id="${infoJson.dropDownCustomFieldId}"]`
      ) ||
      details.querySelector(`select[name*="${infoJson.dropDownCustomFieldId}"]`) ||
      details.querySelector(`#cf_${infoJson.dropDownCustomFieldId}`);

    if (!selectElement) {
      console.log("‚ÑπÔ∏è Case Quantity dropdown not found, nothing to hide");
      return;
    }

    // --- 2) Auto-select a non-empty option so backend has a value ---
    const options = Array.from(selectElement.options || []);
    const defaultOption =
      options.find(o => o.value && !o.disabled) ||
      options.find(o => o.value); // fallback

    if (defaultOption) {
      selectElement.value = defaultOption.value;
      // üîë IMPORTANT: update Zoho's default so future resets keep this value
      selectElement.setAttribute("data-default-value", defaultOption.value);

      console.log("‚úÖ Auto-selected Case Quantity value:", defaultOption.value);

      // Fire change so any Zoho listeners pick it up
      const evt = new Event("change", { bubbles: true });
      selectElement.dispatchEvent(evt);
    } else {
      console.log("‚ö†Ô∏è No non-empty options in Case Quantity select");
    }

    // --- 3) Hide only the Case Quantity row / container ---
    const selectContainer =
      selectElement.closest(".theme-custom-field-select-container") ||
      selectElement.closest(".custom-field-container") ||
      selectElement.closest("div[class*='field']") ||
      selectElement.parentElement;

    if (selectContainer) {
      selectContainer.style.display = "none";
      console.log("‚úÖ Case Quantity select container hidden");
    } else {
      selectElement.style.display = "none";
      console.log("‚úÖ Case Quantity select hidden directly");
    }

    // Hide the Case Quantity label container too (if any)
    const allLabels = details.querySelectorAll("[data-zs-customfield-label]");
    allLabels.forEach(label => {
      const text = label.textContent.trim();
      if (text === "Variants Quantity  *" || text === "Case Quantity *") {
        const ctn =
          label.closest(".theme-product-variant") ||
          label.closest(".theme-custom-field-container") ||
          label.closest("[data-zs-customfield-container]") ||
          label.parentElement;
        if (ctn) {
          ctn.style.display = "none";
          console.log("‚úÖ Case Quantity label container hidden");
        }
      }
    });

    // --- 4) Hide the entire "Pick a Case Size" accordion (summary + body) ---
    const accordions = details.querySelectorAll("details.theme-custom-field-accordion");
    accordions.forEach(acc => {
      const heading = acc.querySelector(".theme-custom-field-heading");
      if (heading && heading.textContent.trim() === "Pick a Case Size") {
        acc.style.display = "none";
        console.log("‚úÖ 'Pick a Case Size' accordion hidden");
      }
    });
  }

  /**
   * Check if product has variants
   */
  function checkHasVariants(details) {
    console.log("üîç Checking if product has variants‚Ä¶");

    // Try to find the "Has Variants" field (hidden input)
    const hasVariantsInput = details.querySelector(
      `input[data-custom-field-id="${infoJson.hasVariantsFieldId}"]`
    );

    // Hide "Has variants" label only inside THIS product
    const labels = details.querySelectorAll("[data-zs-customfield-label]");
    labels.forEach(label => {
      const text = label.textContent.trim();
      console.log(text);
      if (text === "Has variants") {
        const container =
          label.closest(".theme-product-variant") ||
          label.closest(".theme-custom-field-container") ||
          label.closest("[data-zs-customfield-container]") ||
          label.parentElement;

        if (container) {
          container.style.display = "none";
          console.log("üôà Hid 'Has variants' field container");
        }
      }
    });

    if (!hasVariantsInput) {
      console.warn("‚ö†Ô∏è Has Variants field not found - treating as NO variants");
      hideCaseSizeBlock(details);
      return false;
    }

    const hasVariantsValue = (hasVariantsInput.value || "")
      .toString()
      .toLowerCase()
      .trim();
    console.log("üìã Has Variants field value:", hasVariantsValue);

    const hasVariants = hasVariantsValue === "true";

    if (!hasVariants) {
      console.log("üö´ Has variants = false ‚Üí hide Case Size / Case Quantity");
      hideCaseSizeBlock(details);   // simple product behaviour
      return false;                 // stop here, no UOM logic
    }

    // If we reach here, hasVariants = true
    console.log("‚úÖ Product HAS variants - UOM script will run");
    const qtysimple = details.querySelectorAll(".theme-product-quantity-spinner");
    qtysimple.forEach(el => {
      el.style.display = "none";
    });

    return true;
  }

  async function setUom(details) {
    console.log("‚öôÔ∏è Setting up UOM for details:", details);

    // IMPORTANT: Check if product has variants first
    if (!checkHasVariants(details)) {
      console.log("‚èπÔ∏è UOM setup skipped (no variants)");
      return;
    }

    console.log("üü¢ Proceeding with UOM setup - Product has variants");

    // Try multiple selector strategies for Case Quantity dropdown
    let selectElement =
      details.querySelector(
        `select[data-custom-field-id="${infoJson.dropDownCustomFieldId}"]`
      ) ||
      details.querySelector(`select[name*="${infoJson.dropDownCustomFieldId}"]`) ||
      details.querySelector(`#cf_${infoJson.dropDownCustomFieldId}`);

    if (!selectElement) {
      console.warn(
        "‚ö†Ô∏è Select not found with data-custom-field-id, trying waitForElement‚Ä¶"
      );
      try {
        selectElement = await waitForElement(
          `select[data-custom-field-id="${infoJson.dropDownCustomFieldId}"]`,
          details,
          3000
        );
      } catch (error) {
        console.error("‚ùå Failed to find select element:", error);
      }
    }

    let orgQty = details.querySelector("[data-zs-quantity-container]");
    let pricingContainer = details.querySelector("[data-zs-pricing-container]");

    if (!selectElement || !orgQty) {
      console.error("‚ùå Required elements not found for UOM setup");
      return;
    }

    // Create custom quantity input (front-end qty)
    let dummyQty = document.createElement("input");
    dummyQty.style.display = "none";
    dummyQty.setAttribute("type", "number");
    dummyQty.setAttribute("data-custom-qty", "");
    dummyQty.value = 1;
    dummyQty.className = "custom-qty-input";
    orgQty.insertAdjacentElement("afterend", dummyQty);

    // Create conversion field if needed (hidden custom field)
    let selectedUom = null;
    if (infoJson.conversionCustomFieldId) {
      selectedUom = document.createElement("input");
      selectedUom.type = "hidden";
      selectedUom.setAttribute(
        "data-custom-field-id",
        infoJson.conversionCustomFieldId
      );
      selectedUom.name = "conversion_value";
      selectElement.parentElement.appendChild(selectedUom);
    }

    function displayUnitNearPrice(unit, container) {
      const existingLabel = container.querySelector(".uom-label");
      if (existingLabel) existingLabel.remove();

      let unitLabel = "";
      if (unit.includes("kg") || unit.includes("gm")) unitLabel = "per kg";
      else if (unit.includes("l") || unit.includes("ml")) unitLabel = "per l";
      else if (unit.includes("g")) unitLabel = "per g";

      if (!unitLabel) return;

      const el = document.createElement("span");
      el.className = "uom-label";
      el.style.marginLeft = "8px";
      el.style.fontSize = "14px";
      el.style.color = "#666";
      el.textContent = unitLabel;
      container.appendChild(el);
    }

    function processConversion() {
      if (selectElement.value !== "") {
        orgQty.style.display = "none";
        dummyQty.style.display = "block";

        if (selectedUom) {
          selectedUom.value = `${dummyQty.value} x ${selectElement.value}`;
        }

        const selectedValue = parseFloat(selectElement.value) || 0;
        const customQty = parseFloat(dummyQty.value) || 0;
        const calculatedQty = selectedValue * customQty;

        const qtyInput = orgQty.querySelector("[data-zs-quantity]");
        if (qtyInput) qtyInput.value = calculatedQty;

        if (infoJson.showUnitNearPrice && pricingContainer) {
          let unit = selectElement.value.split(" ")[1]?.toLowerCase() || "";
          displayUnitNearPrice(unit, pricingContainer);
        }
      } else {
        orgQty.style.display = "flex";
        dummyQty.style.display = "none";

        if (selectedUom) selectedUom.value = "";

        if (infoJson.showUnitNearPrice && pricingContainer) {
          const removedLabel = pricingContainer.querySelector(".uom-label");
          if (removedLabel) removedLabel.remove();
        }

        const qtyInput = orgQty.querySelector("[data-zs-quantity]");
        if (qtyInput) qtyInput.value = 1;
      }
    }

    selectElement.addEventListener("change", processConversion);
    dummyQty.addEventListener("input", processConversion);

    if (selectElement.value) processConversion();
  }

  async function loadMethods() {
    console.log("üèÅ Loading methods‚Ä¶");
    console.log("üåê Current window.zs_view:", window.zs_view);
    console.log("üõçÔ∏è Current window.zs_product:", window.zs_product);

    if (window.zs_view === "product") {
      const productSelector = `[data-zs-product-id="${window.zs_product.product_id}"]`;
      let productElement = document.querySelector(productSelector);

      if (!productElement) {
        try {
          productElement = await waitForElement(productSelector, document, 5000);
        } catch (error) {
          console.error("‚ùå Failed to find product element:", error);
          return;
        }
      }

      console.log("üõçÔ∏è Found product element:", productElement);
      await setUom(productElement);
    } else {
      console.log("‚ÑπÔ∏è Not a product view, skipping UOM setup");
    }
  }

  function quickViewOpen() {
    console.log("üëÅÔ∏è Quick view opened");
    const quickViewProduct = document.getElementById("product_quick_look");
    if (quickViewProduct) {
      setTimeout(() => setUom(quickViewProduct), 300);
    } else {
      console.error("‚ùå Quick view product element not found!");
    }
  }

  console.log("üëÇ Adding event listeners‚Ä¶");
  document.addEventListener("quickview:opened", quickViewOpen, false);
  document.addEventListener("DOMContentLoaded", loadMethods, false);

  if (document.readyState !== "loading") {
    console.log("üìÑ Document already loaded, running loadMethods immediately");
    loadMethods();
  }

  console.log("‚úÖ Event listeners added successfully");
</script>

<style>
  .custom-qty-input {
    display: block !important;
  }

  /* Hide raw Has-variants input (optional) */
  input[data-custom-field-id="6866972000000725541"] {
    display: none !important;
  }
</style>
<script>
console.log("üõí Cart UOM Custom Quantity Script Initialized");

let cartConfig = {
    "dropDownCustomFieldId": "6866972000000509038",
    "conversionCustomFieldId": "6866972000000509048",
    "hasVariantsFieldId": "6866972000000725541"
};

/**
 * Setup custom quantity input for cart items with variants
 */
function setupCartItemUOM(cartItem, index) {
    console.log(`\n‚öôÔ∏è Setting up UOM for cart item ${index + 1}`);
    
    const itemInfo = cartItem.querySelector('.theme-cart-item-info');
    
    if (!itemInfo) {
        console.log("‚ùå theme-cart-item-info not found");
        return;
    }
    
    const ul = itemInfo.querySelector('ul');
    if (!ul) {
        console.log("‚ùå No ul element found");
        return;
    }
    
    const listItems = ul.querySelectorAll('li');
    let hasVariantsValue = null;
    let variantsQuantityLi = null;
    let variantsQuantityValue = null;
    let hasVariantsLi = null;
    let productId = null;
    
    // Find relevant fields
    listItems.forEach((li) => {
        const text = li.textContent.trim();
        
        if (text.includes('Has variants:')) {
            hasVariantsLi = li;
            const span = li.querySelector('span');
            if (span) {
                hasVariantsValue = span.textContent.trim().toLowerCase();
                console.log(`‚úÖ Has variants: ${hasVariantsValue}`);
            }
        }
        
        if (text.includes('Variants Quantity:')) {
            variantsQuantityLi = li;
            const span = li.querySelector('span');
            if (span) {
                variantsQuantityValue = span.textContent.trim();
                console.log(`‚úÖ Variants Quantity: ${variantsQuantityValue}`);
            }
        }
    });
    
    // Get product ID from cart item
    const qtyInput = cartItem.querySelector('input[data-zs-quantity]');
    if (qtyInput) {
        productId = qtyInput.getAttribute('data-zs-product-id') || 
                   qtyInput.getAttribute('data-zs-product-variant-id');
        console.log(`üì¶ Product ID: ${productId}`);
    }
    
    // Store data attributes on cart item for later use
    if (productId) {
        cartItem.setAttribute('data-product-id', productId);
    }
    
    // ALWAYS hide "Has variants" field
    if (hasVariantsLi) {
        hasVariantsLi.style.display = 'none';
        hasVariantsLi.classList.add('hide-variant-field');
    }
    
    // Mark the cart item
    if (hasVariantsValue === 'true') {
        cartItem.setAttribute('data-has-variants', 'true');
        
        // Parse conversion factor (case quantity)
        let conversionFactor = 1;
        if (variantsQuantityValue) {
            if (variantsQuantityValue.includes('x')) {
                const parts = variantsQuantityValue.split('x').map(p => p.trim());
                if (parts.length === 2) {
                    conversionFactor = parseFloat(parts[1]) || 1;
                }
            } else {
                conversionFactor = parseFloat(variantsQuantityValue) || 1;
            }
        }

        // Store conversion factor on cart item
        cartItem.setAttribute('data-conversion-factor', conversionFactor);
        console.log(`üìê Conversion factor (case quantity): ${conversionFactor}`);
        
        // Store reference to variants quantity display
        if (variantsQuantityLi) {
            cartItem.setAttribute('data-has-variant-display', 'true');
            variantsQuantityLi.style.display = 'list-item';
        }
    } else {
        cartItem.setAttribute('data-has-variants', 'false');
        if (variantsQuantityLi) {
            variantsQuantityLi.style.display = 'none';
            variantsQuantityLi.classList.add('hide-variant-field');
        }
    }

    // Initialize last known quantity on the row (used for +/- detection)
    const qtyInputLive = cartItem.querySelector('input[data-zs-product-variant-id], input[data-zs-product-id]');
    if (qtyInputLive) {
        const initialQty = parseInt(qtyInputLive.value, 10) || 0;
        cartItem.setAttribute('data-last-qty', initialQty);
    }
}

/**
 * Process all cart items
 */
function processAllCartItems() {
    console.log("\nüîç Processing all cart items...");
    
    const cartItems = document.querySelectorAll('.theme-cart-table-row[data-cart-item]');
    
    console.log(`üì¶ Found ${cartItems.length} cart items`);
    
    if (cartItems.length === 0) {
        console.log("‚ö†Ô∏è No cart items found");
        return;
    }
    
    cartItems.forEach((item, index) => {
        setupCartItemUOM(item, index);
    });
    
    console.log("\n‚úÖ All cart items processed");
}

/**
 * Initialize cart UOM
 */
function initCartUOM() {
    console.log("üèÅ Initializing cart UOM...");
    
    if (window.zs_view === '/cart' || window.zs_view === 'cart' || window.location.pathname.includes('/cart')) {
        console.log("‚úÖ Cart page detected");
        
        setTimeout(() => {
            processAllCartItems();
        }, 1000);
        
        observeCartChanges();
    } else {
        console.log("‚ÑπÔ∏è Not a cart page");
    }
}

/**
 * Observe cart changes
 */
function observeCartChanges() {
    console.log("üëÅÔ∏è Setting up cart observer...");
    
    const cartContainer = document.querySelector('.theme-cart-table') || 
                         document.querySelector('.theme-cart-items-container') ||
                         document.querySelector('main');
    
    if (!cartContainer) {
        console.warn("‚ö†Ô∏è Cart container not found for observation");
        return;
    }
    
    const observer = new MutationObserver((mutations) => {
        let shouldReprocess = false;
        
        mutations.forEach(mutation => {
            if (mutation.addedNodes.length > 0) {
                mutation.addedNodes.forEach(node => {
                    if (node.nodeType === 1) {
                        if (node.classList && 
                            (node.classList.contains('theme-cart-table-row') ||
                             node.hasAttribute('data-cart-item') ||
                             node.querySelector && node.querySelector('[data-cart-item]'))) {
                            shouldReprocess = true;
                        }
                    }
                });
            }
        });
        
        if (shouldReprocess) {
            console.log("üîÑ Cart DOM changed, reprocessing items...");
            setTimeout(processAllCartItems, 800);
        }
    });
    
    observer.observe(cartContainer, {
        childList: true,
        subtree: true
    });
    
    console.log("‚úÖ Cart observer active");
}

// Event Listeners
console.log("üëÇ Adding event listeners...");

document.addEventListener('DOMContentLoaded', function() {
    console.log("üìÑ DOM Content Loaded");
    initCartUOM();
});

if (document.readyState !== 'loading') {
    console.log("üìÑ Document already loaded, initializing immediately");
    initCartUOM();
}

let isUpdating = false;

// ‚úÖ Handle Zoho add-to-cart / update
document.addEventListener("zp-event-update-to-cart-success", function (event) {
    console.log("‚úÖ zp-event-update-to-cart-success triggered:", event.detail);
    const productId = event.detail.productId;
    if (!productId) return;
    fixCartQuantity(productId, true);
});

// ‚úÖ Handle Zoho quantity update in cart (plus / minus)
document.addEventListener("zp-event-quantity-update-success", function (event) {
    console.log("‚úÖ zp-event-quantity-update-success triggered:", event.detail);
    const productId = event.detail.productId;
    if (!productId) return;
    fixCartQuantity(productId, true);
});

// ‚úÖ Fallback - Listen to manual quantity input changes
document.addEventListener('change', function(event) {
    // üö´ Skip if we're already updating
    if (isUpdating) {
        console.log("‚è≠Ô∏è Skipping change event (already updating)");
        return;
    }
    
    if (event.target.matches('input[data-zs-product-variant-id], input[data-zs-product-id]')) {
        console.log("‚úÖ Manual quantity change detected via input");
        const productId = event.target.getAttribute('data-zs-product-variant-id') || 
                         event.target.getAttribute('data-zs-product-id');
        if (productId) {
            // Small delay to let Zoho process first
            setTimeout(() => {
                fixCartQuantity(productId, true);
            }, 100);
        }
    }
}, true); // Use capture phase

// ‚úÖ Also fix quantities when page reloads
window.addEventListener("load", function () {
    console.log("üîÅ Page load detected ‚Äî verifying all cart items...");
    setTimeout(() => {
        document.querySelectorAll('.theme-cart-table-row[data-cart-item]').forEach((row) => {
            const pid = row.getAttribute('data-zs-product-variant-id') || row.getAttribute('data-zs-product-id');
            if (pid) fixCartQuantity(pid, false);
        });
    }, 800);
});

/**
 * üîß Core logic ‚Äî case-wise (+/-) using conversion factor
 * - Uses data-conversion-factor (case quantity)
 * - Uses data-last-qty to detect whether user clicked + or -
 */
function fixCartQuantity(productId, triggeredByUser) {
    console.log("‚öôÔ∏è Fixing quantity for:", productId);
    
    // üö´ Set flag to prevent loops
    isUpdating = true;
    
    // Wait for Zoho DOM refresh
    setTimeout(() => {
        const quantityInput = document.querySelector(`input[data-zs-product-variant-id="${productId}"]`) ||
                              document.querySelector(`input[data-zs-product-id="${productId}"]`);
        
        if (!quantityInput) {
            isUpdating = false;
            return console.warn("‚ùå No input found for", productId);
        }
        
        const cartItem = quantityInput.closest('.theme-cart-table-row[data-cart-item]');
        if (!cartItem) {
            isUpdating = false;
            return;
        }
        
        const hasVariants = cartItem.getAttribute('data-has-variants') === 'true';
        if (!hasVariants) {
            isUpdating = false;
            return;
        }

        // üî¢ Get conversion factor (case quantity) from data attribute
        let conversionFactor = parseFloat(cartItem.getAttribute('data-conversion-factor')) || 1;
        if (conversionFactor <= 1) {
            console.log("‚ÑπÔ∏è Conversion factor <= 1, skipping special logic");
            isUpdating = false;
            return;
        }
        
        let currentQty = parseInt(quantityInput.value, 10) || 0;
        let lastQty = parseInt(cartItem.getAttribute('data-last-qty'), 10);
        if (isNaN(lastQty)) lastQty = 0;

        console.log(`üìä currentQty: ${currentQty}, lastQty: ${lastQty}, caseSize: ${conversionFactor}`);
        
        let newQty = currentQty;

        if (!triggeredByUser) {
            // ü©π On page load ‚Üí snap to nearest correct multiple of case quantity
            if (currentQty <= 0) {
                newQty = conversionFactor; // minimum 1 case
            } else {
                const remainder = currentQty % conversionFactor;
                newQty = (remainder === 0) ? currentQty : currentQty - remainder;
                if (newQty < conversionFactor) newQty = conversionFactor;
            }
            console.log(`ü©π Page load fix ‚Üí ${currentQty} ‚Üí ${newQty}`);
        } else {
            // üëÜ User-triggered (+/-) change
            if (currentQty > lastQty) {
                // ‚ûï User clicked plus
                newQty = lastQty + conversionFactor;
                if (newQty < conversionFactor) newQty = conversionFactor;
                console.log(`‚ûï Plus detected ‚Üí ${lastQty} ‚Üí ${newQty}`);
            } else if (currentQty < lastQty) {
                // ‚ûñ User clicked minus
                newQty = lastQty - conversionFactor;
                if (newQty < conversionFactor) {
                    // allow either 0 or minimum 1 case
                    newQty = conversionFactor; 
                }
                console.log(`‚ûñ Minus detected ‚Üí ${lastQty} ‚Üí ${newQty}`);
            } else {
                // Same value or first time ‚Äî just ensure it's at least 1 full case
                if (currentQty <= 0) {
                    newQty = conversionFactor;
                    console.log(`üîß Normalizing from 0 ‚Üí ${newQty}`);
                } else if (currentQty % conversionFactor !== 0) {
                    const remainder = currentQty % conversionFactor;
                    newQty = currentQty - remainder + conversionFactor;
                    console.log(`üîß Normalizing to multiple ‚Üí ${currentQty} ‚Üí ${newQty}`);
                }
            }
        }
        
        if (newQty !== currentQty) {
            quantityInput.value = newQty;
            quantityInput.setAttribute('value', newQty);
            quantityInput.setAttribute('data-zs-old_value', newQty);
            
            // Trigger Zoho backend sync
            const evt = new Event('change', { bubbles: true });
            quantityInput.dispatchEvent(evt);
            
            console.log("‚úÖ Quantity updated to:", newQty);
        } else {
            console.log("‚ÑπÔ∏è Quantity already correct, no change");
        }

        // üß† Save last known quantity for next +/- detection
        cartItem.setAttribute('data-last-qty', newQty);

        // Update variant display if present
        if (cartItem.getAttribute('data-has-variant-display') === 'true') {
            updateVariantsQuantityDisplay(cartItem, newQty, conversionFactor);
        }
        
        // üö´ Release flag after a short delay
        setTimeout(() => {
            isUpdating = false;
            console.log("üîì Update flag released");
        }, 300);
        
    }, 300); // delay lets Zoho finish DOM refresh
}

/**
 * üß© Update variant quantity display
 * Shows like:   2 x 12 , 3 x 8, etc.
 */
function updateVariantsQuantityDisplay(cartItem, totalQuantity, conversionFactor) {
    const itemInfo = cartItem.querySelector('.theme-cart-item-info');
    if (!itemInfo) return;
    
    const ul = itemInfo.querySelector('ul');
    if (!ul) return;
    
    ul.querySelectorAll('li').forEach((li) => {
        if (li.textContent.includes('Variants Quantity:')) {
            const span = li.querySelector('span');
            if (span) {
                const units = Math.floor(totalQuantity / conversionFactor);
                span.textContent = `${units} x ${conversionFactor}`;
                console.log(`üìä Updated display: ${units} x ${conversionFactor}`);
            }
        }
    });
}
</script>
